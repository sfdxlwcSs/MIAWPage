<script>
 var fname, lname, email,userId,persona;
    window.addEventListener('loggedInUserPreChatData', function(e){
        console.log("userInfo received");
        console.log('User First Name', e.detail.fname);
        fname = e.detail.fname;
        lname = e.detail.lname;
        email = e.detail.email;
        userId = e.detail.userId;
        persona =e.detail.persona;
    });
window.addEventListener("onEmbeddedMessagingReady", () => {
    
			console.log('onEmbeddedMessagingReady');
			console.log('User Id myDoverPortal', userId);
			embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
				"UserId" : userId,
				});
      embeddedservice_bootstrap.prechatAPI.setVisiblePrechatFields({
        "_firstName": { "value": fname, "isEditableByEndUser": true },
        "_lastName": { "value": lname, "isEditableByEndUser": true },
        "_email": { "value": email, "isEditableByEndUser": true },
          "Persona":{"value":persona,"isEditableByEndUser": true}
    });  
  });
    
    window.addEventListener("onEmbeddedMessagingReady", () => {
			console.log('Inside Messaging Ready Block');
			let UserId = $A.get('$SObjectType.CurrentUser.Id');
			console.log('User Id', UserId);
			embeddedservice_bootstrap.prechatAPI.setHiddenPrechatFields({
					'UserId' : UserId
				});
  });
    window.addEventListener("onEmbeddedMessagingIdentityTokenExpired", () => {

});
     window.addEventListener('accessTokenRecieved', (event) => {
         
        const result = event.detail.data;
        //console.log('jwtToken method result:', result);
         embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
    		identityTokenType: "JWT",
    		identityToken:result
        });
    }); 
window.addEventListener('customchatloaded', (event) => {
 launchChat();
   });
    function launchChat() {
           embeddedservice_bootstrap.utilAPI.launchChat()
               .then(() => {
                   console.log(
                       'Successfully launched Messaging'
                   );
               }).catch(() => {
                   console.log(
                       'Some error occurred when launching Messaging'
                   );
               }).finally(() => {
                   console.log(
                       'Successfully launched Messaging - Finally'
                   );
               });
       }
</script>
